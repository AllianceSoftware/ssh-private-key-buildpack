#!/usr/bin/env bash

indent() {
	c='s/^/       /'
	case $(uname) in
		Darwin) sed -l "$c";;
		*)      sed -u "$c";;
	esac
}

env_dir=$3
ssh_key="$(cat $env_dir/SSH_KEY)"

if [ "$ssh_key" != "" ]; then
	echo "-----> Running SSH private key setup"

	echo "$ssh_key" | base64 --decode > id_rsa
	(eval `ssh-agent -s` || exit $?) | indent
	(ssh-add id_rsa || exit $?) | indent
	ssh -oStrictHostKeyChecking=no -T git@github.com | indent
	rm id_rsa
else
	echo "-----> No SSH private key"
fi
